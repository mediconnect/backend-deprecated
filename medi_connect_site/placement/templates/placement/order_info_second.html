{% extends "customer_header.html" %}

{% block content %}

<div>
    <h3 id="timer"></h3>
</div>

<form action="{% url 'order_submit_second' order_id=order_id %}" method="post" role="form", enctype="multipart/form-data">
    {% csrf_token %}
    {% for field in form.visible_fields %}
    <div class="form-group{% if field.errors %} has-error{% endif %}">
        <label for="{{ field.label }}">{{ field.label }}</label>
        {{ field }}
        {% if field.help_text %}
        <span class="help-block">{{ field.help_text|safe }}</span>
        {% endif %}
        {% for error in field.errors %}
        <label class="control-label">{{ error }}</label>
        {% endfor %}
    </div>
    {% endfor %}
    <button type="submit" class="btn btn-default">Next</button>
</form>

<script>
(function timer (offset) {
    setTimeout(function () {
        var timestamp = {{ time }};
        timestamp = 5 * 60 - timestamp - offset;
        var minutes =  Math.floor(timestamp / 60);
        var seconds =  Math.floor(timestamp % 60);
        document.getElementById("timer").innerHTML = "距离你的订单结束还有：" +  minutes + " : " + seconds;
        timer(offset + 0.5);
    }, 500);
})(0);

(function check () {
    setTimeout(function () {
        $.ajax({
            url: "{% url 'order_check' %}",
            data: {
                'order_id': {{ order_id }}
            },
            dataType: 'json',
            success: function(data) {
                if (!data.exist) {
                    window.location.href = "{% url 'home' %}";
                }
            }
        });
        check();
    }, 1000);
})();
</script>

{% endblock %}
